#!/usr/bin/env python
# -*- coding: utf-8 -*-

import os
import sys
import zipfile

print "Processing File " + sys.argv[1]

for zip_file in sys.argv[1:]:
    try:
        file = zipfile.ZipFile(zip_file, "r")
        for name in file.namelist():
            utf8name = None
            for coding in ['gbk','gb2312', 'big5', 'cp932', 'iso2022_jp', 'euc_jp', 'shift_jis']:
                try:
                    utf8name = name.decode('gbk')
                    break
                except UnicodeDecodeError:
                    pass

            if utf8name == None:
                print "Failed decoding name %s in %s" % (name, zip_file)
                continue

            print "Extracting " + utf8name
            pathname = os.path.dirname(utf8name)
            if not os.path.exists(pathname) and pathname != "":
                os.makedirs(pathname)
            data = file.read(name)
            if not os.path.exists(utf8name):
                fo = open(utf8name, "w")
                fo.write(data)
                fo.close
        file.close()
    except zipfile.BadZipfile:
        print "Failed unzipping %s" % zip_file
